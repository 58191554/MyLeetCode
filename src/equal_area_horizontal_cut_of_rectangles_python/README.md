# Equal-Area Horizontal Cut of Rectangles

## 问题描述

给定若干个轴对齐的矩形蛋糕，每个矩形由其**左下角**与**右上角**坐标定义：`(x1, y1, x2, y2)`，其中 `x1 < x2`，`y1 < y2`。你需要找到一条**水平直线** `y = h`，将所有矩形整体切分为上下两部分，使得：

> 上方部分（严格在 `y > h` 的部分，包括穿过直线的切片的上侧）的**总面积** = 下方部分（`y < h`）的**总面积**。

若存在多个解，返回任意一个 `h`；若总面积为 0，则可返回任意 `h`（例如所有 `y` 的平均或 `min_y`）。默认矩形之间**可以互相独立**（即使在平面上重叠也按各自面积累加计算，不做合并）。

## 输入

- 整数 `n`：矩形数量。
- 接下来 `n` 行，每行四个实数/整数：`x1 y1 x2 y2`。

## 输出

- 一个实数 `h`：满足等面积切分的水平线的纵坐标（允许一定的浮点误差，如 `1e-6`）。

## 约束（可与面试官确认，以下为建议）

- `1 ≤ n ≤ 2 * 10^5`
- 坐标绝对值不超过 `1e9`
- 允许使用双精度浮点进行计算
- 期望时间复杂度：`O(n log n)`；空间 `O(n)`

## 示例

```
输入:
3
0 0  4 2
1 2  3 5
0 5  2 7

解释：
总面积 =  (4*2) + (2*3) + (2*2) = 8 + 6 + 4 = 18
应找到 h 使得 下方累计面积 = 9

输出:
2.5
```

上例中在 `y = 2.5` 处水平切割时，累积到 2.5 的面积恰为 9，故上下各 9。

## 思路提示（可直接在面试中口述）

- 目标是找 `h` 使得**下方累计面积** `A(h) = 总面积 / 2`。
- 将所有矩形的 `y1` 与 `y2` 作为**纵向事件**；对 `y` 轴做线段扫描（sweep line）：
  - 在每个相邻事件区间 `[y_i, y_{i+1}]` 内，**处于激活状态的矩形集合不变**；
  - 该区间内的**面积密度**（单位高度的面积）等于所有激活矩形在该高度的**宽度之和**：
     `W = Σ (x2 - x1)`（注意：如果允许矩形相互重叠，这里按题意**累加**宽度，不做并集去重）；
  - 该条带的面积为 `W * (y_{i+1} - y_i)`，累加直到第一次超过 `总面积/2`；
  - 在跨越的那一条带中做线性内插：
     `h = y_i + (目标剩余面积) / W`。
- 复杂度：对 `2n` 个事件排序 `O(n log n)`，扫描一遍 `O(n)`。

## 边界与细则

- 若所有矩形总面积为 0，输出任意 `h`（如 `min_y`）。
- 若不允许重叠、或希望按**并集面积**切分，请在题面中**明确**（实现会更复杂，需要动态维护水平并集长度）。
- 输出允许一定误差（例如 `1e-6`），评测按相对/绝对误差判定。

## 函数签名（示例 / Python）

```python
from typing import List, Tuple

def equal_area_cut(rects: List[Tuple[float, float, float, float]]) -> float:
    """
    rects[i] = (x1, y1, x2, y2)
    return y = h
    """
```

> 备注：如果题目更贴近“真实切蛋糕”，通常默认矩形不重叠；若是“加权条带”的抽象问题，则允许重叠并按各自面积累加。与面试官**先对齐语义**再实现。